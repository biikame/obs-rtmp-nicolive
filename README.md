# RTMP NicoLive Plugin for OBS MultiPlatform

ニコニコ生放送用OBS MultiPlatformプラグイン

## 概要

ニコニコ生放送の配信用URLとストリームキーを自動取得して、[OBS MultiPlatform (obs-studio)](https://obsproject.com)で簡単に配信できるようにするプラグインです。

## インストール方法

[doc/INSTALL.md](doc/INSTALL.md)を見て下さい。

## 使い方

配信先を「ニコニコ生放送」にして、ユーザ名とパスワード、または、ユーザーセッション(ブラウザのクッキーに保存される「user_session_数字_16進数」のキー)をいれて、「配信開始」したら、枠を取っているとそのまま配信されます。RTMPのURLやキーを手動で取得する必要はありません。なお、ユーザ名とパスワードのみ入力した場合はセッションを一つ消費します。配信に成功した場合はログイン時のユーザーセッションは保存されます。

このプラグイン自体には枠を自動で取ったり、延長したりすることはできませんので、他のツール([Viqo](https://github.com/diginatu/Viqo)等)とあわせて使って下さい。

### 便利かもしれない機能その1 Viqo連携

「Viqoの設定を読み込む」を有効にすると、[Viqo](https://github.com/diginatu/Viqo) の設定からユーザーセッションを取得できます。Viqoを使用している人はセッションを消費しなくてすみます。

### 便利かもしれない機能その2 ビットレート調整

「映像ビットレートを自動調整」を有効にすると、ニコ生で配信可能なビットレート値を確認して映像ビットレートを自動的に調整してくれます。ただ、音声ビットレートは調整してくれません。本当に動いているかは作者もよくわかってないです。

### 便利かもしれない機能その3 監視

「自動で配信開始と枠移動を行う」を有効にすると監視間隔ごとにニコ生の情報を見て、配信ができるようであれば配信を開始してくれます。また、放送が終了している場合も自動的に終了します。枠が切り替わるタイミングの場合、放送終了予定時間から約10秒後に確認し、新しい放送枠があればそちらに配信しなおしてくれます。

Viqoの自動枠取り機能とあわせて使うとほぼ自動化されて、とても楽です。

### 便利かもしれない機能その4 外部コマンドサーバー(β版)

「外部コマンドサーバを使用」を有効にすると外部から操作できるTCPサーバーが内部で起動します。telnetを使ってちょっと操作から、外部アプリでの本格操作まで、何でも…できるようにはなる予定です。今のところ、ユーザーセッションの設定と配信の開始/終了ができます。通信方法の詳細は [doc/PROTOCOL.md](doc/PROTOCOL.md) を見て下さい。

## 方針とか

### TODO

#### 機能面

* [x] ログイン情報についてViqoと連携する。
* [x] ログイン失敗とか、ダイアログ出るようにしたい。
* [x] 放送が終わって次枠とったら、自動的に変わると嬉しいです。
* [x] ビットレートとか見てくれる。調整までしてくれると、ぐっど。
* [ ] NLEのログイン方法をパクる。
* [x] 外部から、配信開始！設定！とか、できるといいなーって夢をみてます。
* [x] デフォルト設定をいれるようにする。

#### コーディング面

* [x] OBSのコーディングスタイルに合わせる。
* [ ] 冗長な部分を簡潔にする。
* [x] オブジェクトをグローバルで持つって、すげーな、おい。

#### 環境面

* [x] 0.8.3に対応する。
* [x] OBSとは独立してコンパイルできるようにする。
    * [x] Windows (β)
    * [x] Mac OS X (β)
    * [x] Ubuntu Linux (α)
* [x] 配付用バイナリを作る手順を確立する。
    * [x] Windows (β)
    * [x] Mac OS X (β)
    * [x] Ubuntu Linux (α)
* [ ] プラグインインストーラ作る。
